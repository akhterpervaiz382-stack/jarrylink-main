<script>
    async function shortenLink() {
        const original_url = document.getElementById('longUrl').value;
        let short_code = document.getElementById('shortCode').value.trim();
        const btn = document.getElementById('btn');

        if(!original_url) return alert("URL zaroori hai!");
        if(!short_code) short_code = Math.random().toString(36).substring(7);

        btn.innerText = "ARCHITECTING...";
        btn.disabled = true;

        try {
            const res = await fetch('https://jarrylink.site/shorten', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ original_url, short_code })
            });

            if(res.ok) {
                document.getElementById('result').classList.remove('hidden');
                // CLEAN DISPLAY
                document.getElementById('linkSpan').innerText = `jarrylink/${short_code}`;
                btn.innerText = "GENERATE LINK";
            } else {
                alert("Name taken! Try another.");
                btn.innerText = "TRY AGAIN";
            }
        } catch (e) {
            alert("Connection Error!");
        }
        btn.disabled = false;
    }

    function copyLink() {
        const display = document.getElementById('linkSpan').innerText;
        const code = display.split('/')[1];
        
        // Asli link clipboard mein jayega taake chale
        const finalLink = "https://jarrylink.site/" + code;
        
        navigator.clipboard.writeText(finalLink).then(() => {
            const copyBtn = document.getElementById('copyBtn');
            copyBtn.innerText = "COPIED CLEAN LINK!";
            setTimeout(() => { copyBtn.innerText = "COPY CLEAN LINK"; }, 2000);
        });
    }
</script>
